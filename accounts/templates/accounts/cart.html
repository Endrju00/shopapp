{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load accounts_extras %}
{% block content %}
<div style="width:100%; min-height: 90vh;">
  <div style=" width: 70%; min-height: inherit; float: left;">
    <div class="card" id="cart_items" style="width: 100%; min-height: inherit;">
      <legend class="border-bottom mb-4" style="margin-top: 1%; margin-bottom: 5%; width: 96%; margin-left: 2%;">Cart</legend>
      {% if page_obj %}
        {% for cm in page_obj %}
        <div class="container">
          <a class="list-group-item list-group-item-action" href="{% url 'items:detail' cm.cart_item.id %}" style="height:100px; margin-bottom: 10px;">
            <img src="{{ cm.cart_item.first_image.url }}" class="img-thumbnail float-left" style="width: 70px; height:70px; object-fit: cover; margin-right: 10px;">
            <h4 style="float: left; margin-right: 1%;">{{ cm.cart_item.title }}</h4>
            <span class="badge badge-warning" style="margin-top: 7px;">{{ cm.quantity }}</span>
            <div style="float: left; width:91%;">
              <h4 style="display: inline-block; margin: 0;">{{ cm.cart_item.price|multiple:cm.quantity }}zł</h4>
              <form method="post" enctype='multipart/form-data' style="float: right;">
                {% csrf_token %}
                <button class="btn btn-outline-warning btn-sm" type="submit" name="delete_cart_item" value={{cm.id}}><span class="fa fa-trash-o"></span> Delete</button><br><br>
              </form>
            </div>

          </a>
        </div>
        {% endfor %}
        <br>

        <div class="pagination" style="width: 100%; margin-bottom: 20px; position:absolute; bottom:5vh;">
          <span class="step-links" style="margin-left: auto; margin-right: auto;">
              {% if page_obj.has_previous %}
                  <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-outline-warning btn-sm"><span class="fa fa-step-backward"></span> Previous</a>
              {% endif %}

              <span class="btn btn-warning btn-sm">
                  Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
              </span>

              {% if page_obj.has_next %}
                  <a href="?page={{ page_obj.next_page_number }}" class="btn btn-outline-warning btn-sm"><span class="fa fa-step-forward"></span> Next</a>
              {% endif %}
          </span>
        </div><br><br><br>

        <div class="border-top pt-2 mb-1" style="margin-bottom: 20px; position:absolute; bottom:0; left: 1%;">
          <small class="text-muted">
            Want something else? <a class='ml-2' href="{% url 'items:index' %}">See the sale offers.</a>
          </small>
        </div>

      {% else %}
        <h2 style="margin-left: 2%;">Your cart is empty.</h2><br>
        <div class="border-top pt-2 mb-1" style ="margin-bottom: 20px; position:absolute; bottom:0; left: 1%;">
          <small class="text-muted">
            Nothing here? <a class='ml-2' href="{% url 'items:index' %}">See the sale offers.</a>
          </small>
        </div>
      {% endif %}

    </div>
  </div>

  <div class="container card" id="cart_items" style="width:29%; min-height: inherit;">
    <legend class="border-bottom mb-4" style="margin-top: 1%; margin-bottom: 5%;">Summary</legend>
    <h5>Number of items: <strong>{{ num_of_items }}</strong></h5>
    <h5>Total price: <strong>{{ total_sum }}zł</strong></h5><br>
    <legend class="border-bottom mb-4" style="margin-top: 1%; margin-bottom: 5%;">Addres</legend>
    <form method="post" enctype='multipart/form-data' style="float: right;">
      {% csrf_token %}
      {{ form|crispy }}
      <button type="submit" name="submit_order" value="1" class="btn btn-warning" style="position: absolute; bottom: 0; left:5%; margin-bottom:20px; width: 90%;">Submit your order</button>
    </form>
  </div>

</div>
{% endblock %}
